<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“æ—…éŠæ‰‹å†Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        :root { 
            --deep-ocean: #1a237e; --ice-blue: #e3f2fd; --crystal-blue: #90caf9;
            --matcha-green: #43a047; --danger-red: #d32f2f;
            --gold: #fbc02d; --silver: #9e9e9e; --bronze: #a1887f;
        }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .active-tab { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: bold; }
        .flight-group { display: none; }
        .flight-group.active { display: block; }
        .snow-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .category-title { border-left: 4px solid #3b82f6; padding-left: 0.75rem; margin: 1.5rem 0 0.75rem 0; color: #1e40af; font-weight: 700; }
        
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; visibility: hidden; }
        
        .rank-badge { width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 10px; color: white; font-weight: bold; font-size: 10px; }
        .rank-1 { background: var(--gold); } .rank-2 { background: var(--silver); } .rank-3 { background: var(--bronze); }
        .settle-box { background: #fff; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid var(--ice-blue); display: flex; align-items: center; justify-content: space-between; font-size: 13px; }
        .settle-name { font-weight: bold; padding: 4px 10px; border-radius: 6px; }
        .name-pay { color: var(--danger-red); background: #ffebee; }
        .name-get { color: var(--matcha-green); background: #e8f5e9; }
    </style>
</head>
<body class="max-w-md mx-auto bg-white min-h-screen shadow-lg pb-24">

    <div id="loading-overlay">
        <i class="fas fa-snowflake fa-spin fa-3x" style="color:var(--crystal-blue)"></i>
        <p style="margin-top:15px; font-weight:bold; color:var(--deep-ocean)">åŒæ­¥æ•¸æ“šä¸­...</p>
    </div>

    <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 text-center shadow-md">
        <h1 class="text-2xl font-bold italic tracking-wider">2026 åŒ—æµ·åŒ—æµ·</h1>
        <p class="text-sm opacity-90 mt-1 font-medium italic">é›ªåœ°å°è‹±é›„æ”»ç•¥</p>
    </header>

    <nav class="flex border-b sticky top-0 bg-white z-20 shadow-sm overflow-x-auto no-scrollbar">
        <button onclick="showTab('flights')" id="btn-flights" class="flex-none px-3.5 py-4 text-sm font-medium">âœˆï¸ èˆªç­</button>
        <button onclick="showTab('checklist')" id="btn-checklist" class="flex-none px-3.5 py-4 text-sm font-medium">ğŸ“ è¡Œæ</button>
        <button onclick="showTab('airport')" id="btn-airport" class="flex-none px-4 py-3.5 text-sm font-medium">âš ï¸ è¦å‰‡</button>
        <button onclick="showTab('itinerary')" id="btn-itinerary" class="flex-none px-3.5 py-4 text-sm font-medium">ğŸ“ è¡Œç¨‹</button>
        <button onclick="showTab('splitting')" id="btn-splitting" class="flex-none px-3.5 py-4 text-sm font-medium">ğŸ’° åˆ†å¸³</button>
    </nav>

    <main class="p-4">
       <div id="flights" class="tab-content active space-y-4">
            <div class="flex p-1 bg-gray-100 rounded-lg mb-4">
                <button onclick="toggleFlightGroup('direct')" id="btn-direct" class="flex-1 py-2 text-xs font-bold rounded-md bg-white shadow-sm text-blue-600">ç›´é£›çµ„</button>
                <button onclick="toggleFlightGroup('transfer')" id="btn-transfer" class="flex-1 py-2 text-xs font-bold rounded-md text-gray-500">è½‰æ©Ÿçµ„</button>
            </div>
            <!-- Direct Group -->
            <div id="group-direct" class="flight-group active space-y-4">
                <div class="bg-blue-50 border border-blue-100 rounded-2xl p-4 shadow-sm">
                    <h3 class="font-bold text-blue-800 mb-2">å»ç¨‹ï¼šé…·èˆª TR 892</h3>
                    <p class="text-[10px] font-bold text-blue-500 mb-2 uppercase tracking-widest">3æœˆ13æ—¥ (äº”)</p>
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl shadow-inner mb-2 border border-blue-100">
                        <div class="text-center">
                            <span class="block font-black text-xl">06:20</span>
                            <span class="text-[10px] text-gray-400">TPE æ¡ƒåœ’ T1</span>
                        </div>
                        <div class="text-blue-300 text-lg">âœˆï¸</div>
                        <div class="text-center">
                            <span class="block font-black text-xl">11:00</span>
                            <span class="text-[10px] text-gray-400">CTS æ–°åƒæ­²</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-red-500 font-black bg-red-50 p-2 rounded text-center">ğŸš¨ 04:30 ä»¥å‰éœ€æŠµé” T1 æ«ƒæª¯å ±åˆ°</p>
                </div>

                <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4 shadow-sm">
                    <h3 class="font-bold text-slate-800 mb-2">å›ç¨‹ï¼šé…·èˆª TR 893</h3>
                    <p class="text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-widest">3æœˆ17æ—¥ (äºŒ)</p>
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl shadow-inner mb-2 border border-slate-100">
                        <div class="text-center">
                            <span class="block font-black text-xl">18:40</span>
                            <span class="text-[10px] text-gray-400">CTS æ–°åƒæ­²</span>
                        </div>
                        <div class="text-slate-300 text-lg">âœˆï¸</div>
                        <div class="text-center">
                            <span class="block font-black text-xl">22:15</span>
                            <span class="text-[10px] text-gray-400">TPE æ¡ƒåœ’ T1</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-red-500 font-black bg-red-50 p-2 rounded text-center">ğŸš¨ 16:20 ä»¥å‰éœ€æŠµé”æ«ƒæª¯å ±åˆ°</p>
                </div>
            </div>

            <!-- Transfer Group -->
            <div id="group-transfer" class="flight-group space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-2xl p-4 shadow-sm relative overflow-hidden">
                    <div class="absolute right-0 top-0 bg-blue-600 text-white text-[9px] px-3 py-1 font-bold">å»ç¨‹ 1/2</div>
                    <h3 class="font-bold text-blue-800 mb-1">é…·èˆª TR 874</h3>
                    <p class="text-[10px] font-bold text-blue-500 mb-2">3æœˆ12æ—¥ (å››)</p>
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl shadow-inner mb-2 border border-blue-100">
                        <div class="text-center">
                            <span class="block font-black text-xl">14:00</span>
                            <span class="text-[10px] text-gray-400 font-medium">TPE æ¡ƒåœ’ T1</span>
                        </div>
                        <div class="text-blue-400">âœˆï¸</div>
                        <div class="text-center">
                            <span class="block font-black text-xl">18:00</span>
                            <span class="text-[10px] text-gray-400 font-medium">HND ç¾½ç”°/æ±äº¬</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-red-500 font-black bg-red-50 p-2 rounded text-center">ğŸš¨ 12:00 ä»¥å‰éœ€æŠµé”æ«ƒæª¯å ±åˆ°</p>
                </div>
                <div class="bg-indigo-50 border border-indigo-200 rounded-2xl p-4 shadow-sm relative overflow-hidden">
                    <div class="absolute right-0 top-0 bg-indigo-600 text-white text-[9px] px-3 py-1 font-bold">å»ç¨‹ 2/2</div>
                    <h3 class="font-bold text-indigo-800 mb-1">å…¨æ—¥ç©º NH 053</h3>
                    <p class="text-[10px] font-bold text-indigo-500 mb-2">3æœˆ13æ—¥ (äº”)</p>
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl shadow-inner border border-indigo-100">
                        <div class="text-center">
                            <span class="block font-black text-xl">08:00</span>
                            <span class="text-[10px] text-gray-400 font-medium">HND ç¾½ç”°æ©Ÿå ´</span>
                        </div>
                        <div class="text-indigo-400">âœˆï¸</div>
                        <div class="text-center">
                            <span class="block font-black text-xl">09:30</span>
                            <span class="text-[10px] text-gray-400 font-medium">CTS æ–°åƒæ­²</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-red-500 font-black bg-red-50 p-2 rounded text-center">ğŸš¨ 06:30 ä»¥å‰éœ€æŠµé”æ«ƒæª¯å ±åˆ°</p>
                </div>
                <!-- è£œå›è½‰æ©Ÿçµ„å›ç¨‹ -->
                <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4 shadow-sm relative overflow-hidden">
                    <div class="absolute right-0 top-0 bg-slate-600 text-white text-[9px] px-3 py-1 font-bold">å›ç¨‹</div>
                    <h3 class="font-bold text-slate-800 mb-1">é…·èˆª TR 893</h3>
                    <p class="text-[10px] font-bold text-slate-500 mb-2">3æœˆ17æ—¥ (äºŒ)</p>
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl shadow-inner mb-2 border border-slate-100">
                        <div class="text-center">
                            <span class="block font-black text-xl">18:40</span>
                            <span class="text-[10px] text-gray-400 font-medium">CTS æ–°åƒæ­²</span>
                        </div>
                        <div class="text-slate-400">âœˆï¸</div>
                        <div class="text-center">
                            <span class="block font-black text-xl">22:15</span>
                            <span class="text-[10px] text-gray-400 font-medium">TPE æ¡ƒåœ’ T1</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-red-500 font-black bg-red-50 p-2 rounded text-center">ğŸš¨ 16:20 ä»¥å‰éœ€æŠµé” T1 æ«ƒæª¯å ±åˆ°</p>
                </div>
            </div>
        </div>

        
        <div id="checklist" class="tab-content">
            <h3 class="category-title">ğŸªª è­‰ä»¶èˆ‡é‡è¦ç‰©å“</h3>
            <div class="space-y-2 bg-blue-50 p-4 rounded-xl mb-4">
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è­·ç…§ (æ­£æœ¬)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">å°ç£é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬ (é–‹è»Šå¿…å¸¶)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">Visit Japan Web QR Code (æˆªåœ–å‚™ä»½)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æ—¥å¹£ç¾é‡‘ + ä¿¡ç”¨å¡</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æµ·å¤–æ—…éŠä¿éšªå–®æ“š (é›»å­æª”)</span></label>
            </div>

            <h3 class="category-title">ğŸ§¥ é›ªåœ°ä¿æš–ç©¿è‘—</h3>
            <div class="space-y-2 bg-slate-50 p-4 rounded-xl mb-4 text-xs">
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é˜²é¢¨é˜²æ°´é•·ç‰ˆå¤–å¥— (ä¿æš–å¤–å±¤)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">ç™¼ç†±è¡£ / ç¾Šæ¯›å…§å±¤ (3-4å¥—)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é›ªé´ / é«˜æ¡¶é˜²æ»‘é˜²æ°´é‹</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æ¯›å¸½ã€åœå·¾ã€åšè¥ªå­ (ç¾Šæ¯›ä½³)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é˜²æ°´æ‰‹å¥— (ç©é›ªå¿…å‚™)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é‹åº•æ­¢æ»‘å¢Š (é˜²æ­¢å†°ä¸Šæ»‘å€’)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è¼•ä¾¿èƒŒåŒ…</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æ‘ºç–Šå‚˜</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">å¤ªé™½çœ¼é¡ (é›ªç›²é é˜²)</span></label>
            </div>

            <h3 class="category-title">ğŸ”Œ é›»å­èˆ‡ç”Ÿæ´»ç”¨å“</h3>
            <div class="space-y-2 bg-amber-50 p-4 rounded-xl mb-4 text-xs">
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æ‰‹æ©Ÿ</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è€³æ©Ÿ/è€³å¡</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è¡Œå‹•é›»æº (ä½æº«è€—é›»å¿«)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">å¤šå­”å……é›»é ­ + å„é¡ç·šæ</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è»Šç”¨æ‰‹æ©Ÿæ¶ + è»Šå……</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">è¨˜æ†¶å¡</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">å¥½æ¼«éŠæœå‹™/eSIM/æˆ–é ç´„ç•¶åœ° SIM å¡</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é‹ç”¨/æ‰‹æŒæš–æš–åŒ…</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">ä¿æ¿•å™´éœ§ / ä¹³æ¶² / è­·å”‡è† (æ¥µä¹¾ç‡¥)</span></label>
            </div>

            <h3 class="category-title">ğŸ’Š å€‹äººè­·ç†ç”¨å“</h3>
            <div class="space-y-2 bg-emerald-50 p-4 rounded-xl mb-4 text-xs">
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">ç‰™åˆ·ã€ç‰™è† </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æ´—é«®ç²¾ã€æ²æµ´ä¹³ </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">åŒ–å¦å“/ä¿é¤Šå“ </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">ä¹¾æ´—æ‰‹/æ¶ˆæ¯’æ¿•ç´™å·¾ </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">é˜²æ›¬ä¹³ </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">å¸¸å‚™è—¥ (æ­¢ç—›ã€é€€ç‡’ã€è…¸èƒƒ)</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">æšˆè»Šè—¥ </span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">OKç¹ƒ / ç°¡æ˜“æ€¥æ•‘åŒ…</span></label>
                <label class="flex items-start space-x-3"><input type="checkbox" class="checkbox-item mt-1 w-5 h-5 rounded"><span class="text-sm font-medium">éš±å½¢çœ¼é¡åŠç”¨å“ï¼ˆå¦‚éœ€è¦ï¼‰ </span></label>
            </div>
        </div>


        <div id="airport" class="tab-content space-y-4">
            <div class="bg-red-600 p-4 rounded-2xl text-white shadow-md">
                <h3 class="font-black flex items-center mb-2">ğŸš« åš´ç¦æ”œå¸¶ç‰©å“ (è¨—é‹/éš¨èº«çš†ä¸å¯)</h3>
                <ul class="text-xs space-y-2 opacity-95">
                    <li>â€¢ <strong>æ‰“ç«æ©Ÿï¼š</strong>é˜²é¢¨/é›ªèŒ„å‹æ‰“ç«æ©Ÿåš´ç¦ã€‚</li>
                    <li>â€¢ <strong>æ˜“ç‡ƒç‰©å“ï¼š</strong>éœ²ç‡Ÿç”¨ç“¦æ–¯ç½ã€å™´éœ§ç½(é™¤è‡­/é«®è† )å–®ç½è¶…é500mlã€‚</li>
                    <li>â€¢ <strong>é•ç¦å“ï¼š</strong>è‚‰é¡è£½å“ã€æ–°é®®è”¬æœã€ç¨®å­ã€‚</li>
                </ul>
            </div>
            <div class="bg-blue-600 p-4 rounded-2xl text-white shadow-md">
                <h3 class="font-black flex items-center mb-2">ğŸ’ å¿…é ˆéš¨èº«æ”œå¸¶ (ä¸å¯è¨—é‹)</h3>
                <ul class="text-xs space-y-2 opacity-95">
                    <li>â€¢ <strong>é›»æ± é¡ï¼š</strong>è¡Œå‹•é›»æºã€ç›¸æ©Ÿ/æ‰‹æ©Ÿé‹°é›»æ± ã€‚</li>
                    <li>â€¢ <strong>è²´é‡å“ï¼š</strong>ç¾é‡‘ã€ä¿¡ç”¨å¡ã€è­·ç…§ã€é§•ç…§ã€ç›¸æ©Ÿã€ç­†é›»ã€‚</li>
                    <li>â€¢ <strong>å‡ºç¤ºé¡ï¼š</strong>æ©Ÿç¥¨ã€æ©Ÿç¥¨ã€ç™»æ©Ÿè­‰ã€ç°½è­‰æ–‡ä»¶ã€æ—…éŠä¿éšªã€‚</li>
                </ul>
            </div>
            <div class="bg-emerald-600 p-4 rounded-2xl text-white shadow-md">
                <h3 class="font-black flex items-center mb-2">ğŸ§³ å¿…é ˆè¨—é‹ç‰©å“</h3>
                <ul class="text-xs space-y-2 opacity-95">
                    <li>â€¢ <strong>æ¶²é«”è¦ç¯„ï¼š</strong>å–®ä»¶è¶…é 100mlã€‚100mlä»¥ä¸‹éœ€è£æ–¼é€æ˜å¡‘è† è¢‹å…§(æ¯äººé™ä¸€è¢‹)æ–¹å¯éš¨èº«ã€‚</li>
                    <li>â€¢ <strong>å°–éŠ³ç‰©ï¼š</strong>æŒ‡ç”²å‰ªã€ä¿®çœ‰åˆ€ã€å°åˆ€ã€ç‘å£«åˆ€ã€‚</li>
                    <li>â€¢ <strong>æ£æ£’ï¼š</strong>è…³æ¶ã€è‡ªæ‹æ£’(ç¸®åˆå¾Œé•·åº¦è¶…é60cmè€…å¿…é ˆè¨—é‹)ã€‚</li>
                </ul>
            </div>
            <div class="bg-gray-100 p-3 rounded-lg text-[10px] text-gray-500">
                è¨»ï¼šè¡Œå‹•é›»æºä¸å¯æ¨™ç¤ºä¸æ¸…ã€‚æ—¥æœ¬æµ·é—œæª¢æŸ¥åš´æ ¼ï¼Œå»ºè­°å…ˆå°‡è¡Œå‹•é›»æºæ¨™ç±¤åŠ å›ºã€‚
            </div>
<div class="bg-amber-50 border border-amber-200 p-4 rounded-2xl">
                <h3 class="font-bold text-amber-800 text-sm mb-2">âš ï¸ æµ·é—œæé†’</h3>
<ul class="text-xs space-y-2 opacity-95">
                    <li>â€¢ <strong>è‚‰é¡è£½å“ï¼š</strong>é¦™è…¸ã€ç«è…¿ã€è‚‰ä¹¾ã€è‡˜è‚‰ã€è‚‰é¬†ã€ç‰›è‚‰ä¹¾ã€ç½è£è‚‰ã€‚</li>
                    <li>â€¢ <strong>æœªç¶“æ ¸å‡†çš„ä¹³è£½å“ï¼š</strong>ç”Ÿä¹³ã€æœªæ®ºèŒä¹³é…ªã€éƒ¨åˆ†æ‰‹å·¥èµ·å¸ã€‚</li>
                    <li>â€¢ <strong>æ‰€æœ‰ç”Ÿé®®æ°´æœã€è”¬èœï¼š</strong>è•‰ã€è‘¡è„ã€è˜‹æœã€ç”Ÿèœã€é¦¬éˆ´è–¯ã€è’œé ­ã€‚</li>
                    <li>â€¢ <strong>é«˜é¢¨éšªè›‹è£½å“ï¼š</strong>ç”Ÿè›‹ã€åŠç†Ÿè›‹ã€æºå¿ƒè›‹ã€æœªæª¢ç–«é¹¹è›‹ã€èŒ¶è‘‰è›‹ã€‚</li>
                    <li>â€¢ <strong> å¯µç‰©é£Ÿå“ï¼š</strong>å¤§å¤šå«è‚‰é¡ã€‚</li>
<ul class="text-xs space-y-2 opacity-95">
åš´ç¦æ”œå¸¶å…¥å¢ƒå°ç£ã€‚åˆçŠ¯å³ç½°æ–°å°å¹£ 20 è¬å…ƒï¼Œå†çŠ¯å³é–‹ç½° 100 è¬å…ƒã€‚</p>
            </div>

        </div>

        <div id="itinerary" class="tab-content">
            <div id="itinerary-list" class="space-y-8"></div>
        </div>

        <div id="splitting" class="tab-content space-y-4">
            <div class="snow-card bg-emerald-50 border-emerald-100">
                <h3 class="font-bold text-emerald-800 mb-2 text-sm flex items-center justify-between">
                    <span><i class="fas fa-cloud mr-2"></i> é›²ç«¯åŒæ­¥ç‹€æ…‹</span>
                    <span id="sync-status" class="text-[10px] bg-white px-2 py-0.5 rounded text-gray-400 font-mono">STANDBY</span>
                </h3>
                <button onclick="downloadFromCloud()" class="w-full bg-white border border-emerald-600 text-emerald-600 text-[11px] font-bold p-2 rounded-lg">æ‰‹å‹•åˆ·æ–°æ•¸æ“š</button>
            </div>

            <div class="snow-card w-full box-border overflow-hidden">
    <h3 class="font-bold text-blue-800 mb-4 text-sm"><i class="fas fa-edit mr-2"></i> æ”¯å‡ºç™»éŒ„</h3>
    <div class="space-y-3">
        <input type="text" id="payer" list="name-list" class="w-full p-3 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-200 outline-none" placeholder="èª°ä»˜éŒ¢ï¼Ÿ">
        <datalist id="name-list"></datalist>

        <div class="flex gap-2 w-full">
            <input type="number" id="amount" class="min-w-0 flex-1 p-3 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-200 outline-none" placeholder="é‡‘é¡" inputmode="numeric">
            <select id="currency" onchange="updateRateUI()" class="w-[85px] shrink-0 p-3 border border-gray-200 rounded-xl text-[12px] bg-gray-50 font-bold">
                <option value="TWD">å°å¹£</option>
                <option value="JPY" selected>æ—¥å¹£</option>
            </select>
        </div>

        <div id="rate-display" class="text-[10px] text-blue-600 font-bold text-center bg-blue-50 py-1 rounded-lg">åŒ¯ç‡è®€å–ä¸­...</div>

        <input type="text" id="item" class="w-full p-3 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-200 outline-none" placeholder="é …ç›®èªªæ˜">

        <div id="members-area" class="flex flex-wrap gap-2 bg-slate-50 p-3 rounded-xl border border-dashed border-gray-300 min-h-[50px]"></div>

        <button onclick="addRecord()" id="save-btn" class="w-full bg-blue-600 text-white font-bold p-4 rounded-xl shadow-lg active:scale-95 transition-all text-sm">ç¢ºèªé€å‡ºä¸¦åŒæ­¥</button>
    </div>
</div>

            <div id="calculation-results" class="space-y-4">
                <div class="snow-card bg-blue-50 border-blue-100">
                    <h3 class="font-bold text-blue-900 mb-3 text-sm flex items-center"><i class="fas fa-snowflake mr-2"></i> æœ€çŸ­é‚„æ¬¾æ–¹æ¡ˆ (å°å¹£)</h3>
                    <div id="settlement-plan" class="space-y-2"></div>
                </div>

                <div class="snow-card">
                    <h3 class="font-bold text-gray-700 mb-3 text-sm flex items-center"><i class="fas fa-crown mr-2"></i> å¢Šä»˜æ’è¡Œæ¦œ</h3>
                    <div id="payment-summary" class="text-xs space-y-2"></div>
                </div>

                <div class="snow-card">
                    <h3 class="font-bold text-gray-700 mb-3 text-sm flex items-center"><i class="fas fa-chart-pie mr-2"></i> å€‹äººæç›Š</h3>
                    <div id="personal-summary" class="text-xs space-y-2"></div>
                </div>

                <div class="snow-card bg-slate-50">
                    <h3 class="font-bold text-gray-500 mb-3 text-sm flex items-center justify-between">
                        <span><i class="fas fa-history mr-2"></i> è©³ç´°æ­·å²ç´€éŒ„</span>
                        <button onclick="clearRecords()" class="text-red-400 font-normal text-[10px]">æ¸…ç©º</button>
                    </h3>
                    <div id="history-list" class="divide-y divide-gray-200"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="fixed bottom-0 w-full max-w-md bg-amber-50 border-t border-amber-100 px-4 py-3 z-30">
        <marquee class="text-[11px] font-bold text-amber-900">ğŸ“¢ æé†’ï¼šæ³¨æ„éš¨èº«è¡Œæï¼Œé¿å…è¢«æµ·é—œé–‹ç®±æª¢æŸ¥ã€‚ &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
    æé†’ï¼šè«‹ç¢ºèªè­·ç…§æœ‰æ•ˆæœŸéœ€åœ¨å…­å€‹æœˆä»¥ä¸Šã€‚ &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
    æé†’ï¼šç¦æ­¢æ”œå¸¶æ–°é®®è”¬æœåŠè‚‰é¡è£½å“å…¥å¢ƒã€‚ &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp;
    æé†’ï¼šæ³¨æ„å…ç¨…é¡åº¦ï¼Œè«‹ç•™æ„è³¼è²·é‡‘é¡ã€‚ &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp;
    æé†’ï¼šç¦æ­¢åœ¨é›ªçƒå…§è—çŸ³é ­æŠ•æ“²ã€‚ &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp;</marquee>
    </footer>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwgmHOOhdgywLdsP3oW_5kSCwwSVtfm22Kwhj9bEFQXr1mk9XayKxTLF478sSYh623x/exec";
        let members = ["ä¸€è™Ÿ", "è©©æ½”", "Yuzugi", "å°ç‘œ", "è€æ", "æ ©ç¿”"];
        let records = [];
        let jpyRate = 0.21;

        window.onload = async () => {
            renderItinerary();
            await fetchRate();
            const lastTab = localStorage.getItem('last_tab') || 'flights';
            showTab(lastTab);
            downloadFromCloud();
        };

        function showTab(tabId) {
            localStorage.setItem('last_tab', tabId);
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-tab', 'text-blue-600'));
            const activeTab = document.getElementById(tabId);
            const activeBtn = document.getElementById('btn-' + tabId);
            if(activeTab) activeTab.classList.add('active');
            if(activeBtn) activeBtn.classList.add('active-tab', 'text-blue-600');
            if(tabId === 'splitting') renderSplitUI();
        }

        async function fetchRate() {
            try {
                const res = await fetch('https://open.er-api.com/v6/latest/JPY');
                const data = await res.json();
                jpyRate = data.rates.TWD;
                document.getElementById('rate-display').innerText = `å³æ™‚åŒ¯ç‡ï¼š1 JPY â‰ˆ ${jpyRate.toFixed(4)} TWD`;
            } catch (e) { document.getElementById('rate-display').innerText = `ä½¿ç”¨é è¨­åŒ¯ç‡ 0.21`; }
        }

        async function downloadFromCloud() {
            const overlay = document.getElementById('loading-overlay');
            const status = document.getElementById('sync-status');
            overlay.style.visibility = 'visible';
            status.innerText = 'SYNCING...';
            try {
                const r = await fetch(GAS_URL);
                const data = await r.json();
                
                // å¼·åŒ–è§£æé‚è¼¯ï¼Œé¿å…é›²ç«¯å›å‚³æ ¼å¼ä¸ç¬¦å°è‡´å‡ºéŒ¯
                records = data.filter(row => row[1] && row[3]).map(row => {
                    let parsedMembers = [];
                    try {
                        parsedMembers = (typeof row[5] === 'string') ? JSON.parse(row[5]) : row[5];
                    } catch(e) { parsedMembers = members; } // è§£æå¤±æ•—æ™‚é è¨­å…¨å“¡åˆ†æ”¤

                    return {
                        date: row[0] ? new Date(row[0]).toLocaleString('zh-TW', {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'}) : 'ç„¡æ—¥æœŸ',
                        payer: row[1],
                        item: row[2] || 'æœªåˆ†é¡æ”¯å‡º',
                        amount: Math.ceil(parseFloat(row[3])) || 0,
                        curr: row[4] || 'TWD',
                        members: Array.isArray(parsedMembers) ? parsedMembers : members
                    };
                });
                
                calculateAllStat();
                status.innerText = 'SUCCESS ' + new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            } catch(e) { 
                status.innerText = 'ERROR';
                console.error("ä¸‹è¼‰å¤±æ•—:", e);
            }
            overlay.style.visibility = 'hidden';
        }

        function calculateAllStat() {
            let balances = {}; let totalPaid = {};
            members.forEach(m => { balances[m] = 0; totalPaid[m] = 0; });
            
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            
            // 1. è™•ç†æç›Šèˆ‡æ­·å²ç´€éŒ„
            records.forEach(r => {
                const share = r.amount / r.members.length;
                totalPaid[r.payer] = (totalPaid[r.payer] || 0) + r.amount;
                balances[r.payer] += r.amount;
                r.members.forEach(m => {
                    balances[m] = (balances[m] || 0) - share;
                });
                
                const historyItem = document.createElement('div');
                historyItem.className = "py-3 flex justify-between text-[11px] items-start";
                historyItem.innerHTML = `<div class="flex-1"><div class="font-bold text-blue-800">${r.payer}: ${r.item}</div><div class="text-gray-400 text-[9px] mt-1">${r.date} | åˆ†æ”¤: ${r.members.join(', ')}</div></div><div class="font-bold text-blue-600 ml-2">$${r.amount}</div>`;
                list.insertBefore(historyItem, list.firstChild);
            });

            // 2. æ¸²æŸ“æ’è¡Œæ¦œ
            const rankDiv = document.getElementById('payment-summary');
            rankDiv.innerHTML = '';
            const rankColors = ["rank-1", "rank-2", "rank-3"];
            Object.entries(totalPaid).sort((a,b)=>b[1]-a[1]).forEach(([n, a], i) => {
                if(a <= 0) return;
                rankDiv.innerHTML += `<div class="flex justify-between items-center py-1"><span><span class="rank-badge ${rankColors[i] || 'bg-gray-200'}">${i+1}</span>${n}</span><span class="font-bold">$${Math.round(a)}</span></div>`;
            });

            // 3. æ¸²æŸ“å€‹äººæç›Š
            const pDiv = document.getElementById('personal-summary');
            pDiv.innerHTML = '';
            for(let n in balances) {
                const b = Math.ceil(balances[n]);
                if(Math.abs(b) < 1) continue;
                pDiv.innerHTML += `<div class="flex justify-between py-1"><span>${n}</span><span class="${b>0?'text-green-600':'text-red-500'} font-bold">${b>0?'æ‡‰æ”¶':'æ‡‰ä»˜'} $${Math.abs(b)}</span></div>`;
            }

            // 4. æ¸²æŸ“æœ€çŸ­é‚„æ¬¾æ–¹æ¡ˆ
            renderSettlementPlan(balances);
        }

        function renderSettlementPlan(balances) {
            const planDiv = document.getElementById('settlement-plan');
            planDiv.innerHTML = '';
            let debtors = [], creditors = [];
            for(let n in balances) {
                if(balances[n] < -0.5) debtors.push({n, amt: Math.abs(balances[n])});
                else if(balances[n] > 0.5) creditors.push({n, amt: balances[n]});
            }
            while(debtors.length && creditors.length) {
                debtors.sort((a,b)=>b.amt-a.amt); creditors.sort((a,b)=>b.amt-a.amt);
                let settleAmt = Math.min(debtors[0].amt, creditors[0].amt);
                planDiv.innerHTML += `<div class="settle-box"><span class="settle-name name-pay">${debtors[0].n}</span><div class="text-center flex-1"><i class="fas fa-arrow-right text-blue-200 text-xs"></i><div class="font-bold text-blue-700">$${Math.ceil(settleAmt)}</div></div><span class="settle-name name-get">${creditors[0].n}</span></div>`;
                debtors[0].amt -= settleAmt; creditors[0].amt -= settleAmt;
                if(debtors[0].amt < 1) debtors.shift();
                if(creditors[0].amt < 1) creditors.shift();
            }
        }

        async function addRecord() {
            const payer = document.getElementById('payer').value.trim();
            const item = document.getElementById('item').value.trim();
            let amount = parseFloat(document.getElementById('amount').value);
            const curr = document.getElementById('currency').value;
            const checked = Array.from(document.querySelectorAll('input[name="m-check"]:checked')).map(el => el.value);

            if(!payer || isNaN(amount) || checked.length === 0) return alert('è«‹å¡«å¯«å®Œæ•´å…§å®¹');

            if(curr === 'JPY') {
                const twdValue = Math.ceil(amount * jpyRate);
                if(!confirm(`æ—¥å¹£ Â¥${amount} â” å°å¹£ ç´„ $${twdValue}\nç¢ºèªæ–°å¢ï¼Ÿ`)) return;
                amount = twdValue;
            }

            const btn = document.getElementById('save-btn');
            const overlay = document.getElementById('loading-overlay');
            btn.disabled = true; btn.innerText = "æ­£åœ¨å„²å­˜...";
            overlay.style.visibility = 'visible';

            const payload = { payer, item, amount, curr, members: JSON.stringify(checked) };
            
            try {
                await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                // å»¶é²é‡è¼‰ç¢ºä¿é›²ç«¯å·²å¯«å…¥
                setTimeout(() => { location.reload(); }, 1000); 
            } catch (e) {
                alert('å‚³è¼¸å¤±æ•—');
                btn.disabled = false; overlay.style.visibility = 'hidden';
            }
        }

        function renderSplitUI() {
            const area = document.getElementById('members-area');
            const datalist = document.getElementById('name-list');
            if(!area) return;
            area.innerHTML = ''; datalist.innerHTML = '';
            members.forEach(m => {
                area.innerHTML += `<label class="bg-white border border-gray-200 px-3 py-1.5 rounded-full text-[11px] flex items-center shadow-sm"><input type="checkbox" name="m-check" value="${m}" checked class="mr-1.5"> ${m}</label>`;
                datalist.innerHTML += `<option value="${m}">`;
            });
        }

        function renderItinerary() {
            const days = [
                { id: 1, date: "3/13 (äº”)", color: "blue-600", items: [{ time: "09:30", text: "è½‰æ©Ÿçµ„æŠµé”æ–°åƒæ­²" }, { time: "11:00", text: "ç›´é£›çµ„æŠµé”æ–°åƒæ­²" }, { time: "13:00", text: "ç§Ÿè»Šä¸­å¿ƒå–è»Š " }, { time: "15:00", text: "æœ­å¹Œé£¯åº— Check-in" }]},
            { id: 2, date: "3/14 (å…­)", color: "blue-400", items: [{ time: "08:30", text: "æ—­å·å‹•ç‰©åœ’å‡ºç™¼" }, { time: "11:00", text: "ğŸ§ ä¼éµéŠè¡Œè§€è³" }, { time: "18:00", text: "ç¾ç‘›é’æ± å¤œé–“é»ç‡ˆ" }]},
            { id: 3, date: "3/15 (æ—¥)", color: "pink-500", items: [{ time: "08:00", text: "æœ­å¹Œæ·±åº¦éŠğŸ¦€ğŸ¦€ğŸ¦€" }]},
            { id: 4, date: "3/16 (ä¸€)", color: "emerald-500", items: [{ time: "08:30", text: "Kiroro æ»‘é›ªå ´é«”é©—" }, { time: "16:00", text: "å°æ¨½é‹æ²³" }, { time: "19:00", text: "å°æ¨½æ™šé¤" }]},
            { id: 5, date: "3/17 (äºŒ)", color: "slate-700", items: [{ time: "8:00", text: "æœ€å¾Œè£œè²¨" }, { time: "16:00", text: "å‰å¾€æ©Ÿå ´ (é‚„è»Š)" }, { time: "18:40", text: "æ–°åƒæ­²èµ·é£› (TR893)" }]}
        ];
            const list = document.getElementById('itinerary-list');
            list.innerHTML = days.map(day => `
                <div class="border-l-4 border-${day.color} pl-4 relative">
                    <h4 class="font-black text-${day.color} text-lg mb-4">${day.date}</h4>
                    ${day.items.map(i => `<div class="flex space-x-3 mb-2"><span class="text-xs text-gray-400 mt-1">${i.time}</span><span class="text-sm">${i.text}</span></div>`).join('')}
                </div>`).join('');
        }

        function toggleFlightGroup(g) {
            document.querySelectorAll('.flight-group').forEach(el => el.classList.remove('active'));
            document.getElementById('group-' + g).classList.add('active');
            document.getElementById('btn-direct').className = g === 'direct' ? 'flex-1 py-2 text-xs font-bold rounded-md bg-white shadow-sm text-blue-600' : 'flex-1 py-2 text-xs font-bold rounded-md text-gray-500';
            document.getElementById('btn-transfer').className = g === 'transfer' ? 'flex-1 py-2 text-xs font-bold rounded-md bg-white shadow-sm text-blue-600' : 'flex-1 py-2 text-xs font-bold rounded-md text-gray-500';
        }

        function updateRateUI() {
            document.getElementById('rate-display').style.opacity = document.getElementById('currency').value === 'JPY' ? '1' : '0';
        }
    </script>
</body>
</html>




